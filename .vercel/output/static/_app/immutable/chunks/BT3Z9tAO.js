import{az as T,D as k,ay as D,ag as H,aA as M}from"./AQxm7BEp.js";import{b as F,a as S,p as z,c as C}from"./DEvjWbWR.js";function U(a,i,o){T(()=>{var r=k(()=>i(a,o==null?void 0:o())||{});if(o&&(r!=null&&r.update)){var t=!1,c={};D(()=>{var n=o();H(n),t&&M(c,n)&&(c=n,r.update(n))}),t=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function N(a){const i=JSON.parse(a);return i.data&&(i.data=z(i.data,C.decoders)),i}function m(a){return HTMLElement.prototype.cloneNode.call(a)}function g(a,i=()=>{}){const o=async({action:t,result:c,reset:n=!0,invalidateAll:s=!0})=>{c.type==="success"&&(n&&HTMLFormElement.prototype.reset.call(a),s&&await F()),(location.origin+location.pathname===t.origin+t.pathname||c.type==="redirect"||c.type==="error")&&S(c)};async function r(t){var b,y,h,w,A;if(((b=t.submitter)!=null&&b.hasAttribute("formmethod")?t.submitter.formMethod:m(a).method)!=="post")return;t.preventDefault();const n=new URL((y=t.submitter)!=null&&y.hasAttribute("formaction")?t.submitter.formAction:m(a).action),s=(h=t.submitter)!=null&&h.hasAttribute("formenctype")?t.submitter.formEnctype:m(a).enctype,u=new FormData(a),d=(w=t.submitter)==null?void 0:w.getAttribute("name");d&&u.append(d,((A=t.submitter)==null?void 0:A.getAttribute("value"))??"");const f=new AbortController;let p=!1;const L=await i({action:n,cancel:()=>p=!0,controller:f,formData:u,formElement:a,submitter:t.submitter})??o;if(p)return;let l;try{const e=new Headers({accept:"application/json","x-sveltekit-action":"true"});s!=="multipart/form-data"&&e.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(s)?s:"application/x-www-form-urlencoded");const x=s==="multipart/form-data"?u:new URLSearchParams(u),E=await fetch(n,{method:"POST",headers:e,cache:"no-store",body:x,signal:f.signal});l=N(await E.text()),l.type==="error"&&(l.status=E.status)}catch(e){if((e==null?void 0:e.name)==="AbortError")return;l={type:"error",error:e}}L({action:n,formData:u,formElement:a,update:e=>o({action:n,result:l,reset:e==null?void 0:e.reset,invalidateAll:e==null?void 0:e.invalidateAll}),result:l})}return HTMLFormElement.prototype.addEventListener.call(a,"submit",r),{destroy(){HTMLFormElement.prototype.removeEventListener.call(a,"submit",r)}}}export{U as a,g as e};
